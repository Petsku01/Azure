# Create hub VNet
az network vnet create \
  --resource-group myResourceGroup \
  --name hubVNet \
  --address-prefix 10.1.0.0/16 \
  --subnet-name FirewallSubnet \
  --subnet-prefix 10.1.1.0/24 \
  --location eastus

# Create spoke VNet
az network vnet create \
  --resource-group myResourceGroup \
  --name spokeVNet \
  --address-prefix 10.2.0.0/16 \
  --subnet-name WorkloadSubnet \
  --subnet-prefix 10.2.1.0/24 \
  --location eastus

# Peer hub to spoke
az network vnet peering create \
  --resource-group myResourceGroup \
  --name hubToSpokePeering \
  --vnet-name hubVNet \
  --remote-vnet spokeVNet \
  --allow-vnet-access \
  --allow-forwarded-traffic

# Peer spoke to hub
az network vnet peering create \
  --resource-group myResourceGroup \
  --name spokeToHubPeering \
  --vnet-name spokeVNet \
  --remote-vnet hubVNet \
  --allow-vnet-access \
  --allow-forwarded-traffic
